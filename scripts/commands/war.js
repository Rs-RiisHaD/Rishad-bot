let activeWars = {};

module.exports.config = {
  name: "war",
  version: "1.0.0",
  permission: 1, // Admin-only
  credits: "RiisHaD SoBuJ",
  description: "ржЧрж╛рж▓рж┐ ржмрзЛржорзНржмрж┐ржВ ржпрзБржжрзНржз (рж╢рзБржзрзБ ржЕрзНржпрж╛ржбржорж┐ржи)",
  prefix: false,
  category: "fun",
  usages: "war @mention",
  cooldowns: 5
};

module.exports.run = async function ({ api, event }) {
  const { threadID, messageID, senderID, mentions, body } = event;

  // Admin check
  const threadInfo = await api.getThreadInfo(threadID);
  const isAdmin = threadInfo.adminIDs.some(admin => admin.id === senderID);

  if (!isAdmin) {
    return api.sendMessage("тЭМ | ржПржЗ ржХржорж╛ржирзНржбржЯрж┐ ржЪрж╛рж▓рж╛рждрзЗ рж╣рж▓рзЗ ржЕрзНржпрж╛ржбржорж┐ржи рж╣рждрзЗ рж╣ржмрзЗ!", threadID, messageID);
  }

  // Stop command
  if (body.toLowerCase().includes("stop")) {
    if (activeWars[threadID]) {
      clearInterval(activeWars[threadID]);
      delete activeWars[threadID];
      return api.sendMessage("ЁЯЫС | ржЧрж╛рж▓рж┐рж░ ржпрзБржжрзНржз ржерзЗржорзЗ ржЧрзЗржЫрзЗ ржнрж╛ржЗ!", threadID, messageID);
    } else {
      return api.sendMessage("тЪая╕П | ржПржЦржи ржХрзЛржирзЛ ржпрзБржжрзНржз ржЪрж▓ржЫрзЗ ржирж╛ред", threadID, messageID);
    }
  }

  const mentionedIDs = Object.keys(mentions);
  if (mentionedIDs.length === 0) {
    return api.sendMessage("тЪая╕П | ржжрзЯрж╛ ржХрж░рзЗ ржЖржЧрзЗ ржХрж╛ржЙржХрзЗ @mention ржХрж░рзЛ!", threadID, messageID);
  }

  const targetID = mentionedIDs[0];
  const targetName = mentions[targetID];

  const bokas = [
    "рждрзЛржЧрзЛрж░рзЗ ржлрж╛рж╕рж┐рждрзЗ рж▓ржЯржХрж╛ржЗрзЯрж╛ ржЪрзБржжржорзБ",
    "рждрзЛржЧрзЛрж░ ржзрзЛржи ржЯрж╛ржЗржирж╛ рждрзЛржЧрзЛрж░ ржкрж┐ржЫржи ржжрж┐рзЯрж╛ ржврзБржХрж╛ржорзБ",
    "ржЬржВ ржзрж░рж╛ рж▓рзЛрж╣рж╛ ржжрж┐рзЯрж╛ ржкрж╛ржХрж┐рж╕рзНрждрж╛ржирзЗрж░ ржорж╛ржиржЪрж┐рждрзНрж░ ржмрж╛ржирж╛ржЗрзНрзЯрж╛ рждрзЛржжрзЗрж░ ржкрж┐ржЫржи ржжрж┐рзЯрж╛ ржврзБржХрж╛ржорзБред",
    "рждрж░ ржорж╛рзЯрзЗрж░ ржнрзЛржжрж╛ рж╢рж┐рж░рж┐рж╖ ржХрж╛ржЧржЬ ржжрж┐рзЯрж╛ ржШржЗрж╖рж╛ ржжрж┐ржорзБред",
    "рждрж░ ржорж╛рзЯрзЗрж░ ржнрзЛржжрж╛ ржмрзЛржорзНржмрж╛ржЗ ржорж░рж┐ржЪ ржжрж┐рзЯрж╛ ржЪрзБржжрж╛ржорзБред",
    "рждрж░ рж╣рзЛржЧрж╛рзЯ ржЗржиржкрзБржЯ, рждрж░ ржорж╛рзЯрзЗрж░ ржнрзЛржжрж╛рзЯ ржЖржЙржЯржкрзБржЯред",
    "рждрж░ ржмрж╛ржкрзЗрж░ ржкрзБржЯржХрж┐рж░ ржлрзБржЯрж╛ ржжрж┐рзЯрж╛ ржХрж╛ржбрж▓ ржврзБржХрж╛ржорзБред",
    "ржирж┐ржЬрж╛ржорзАрж░ ржЧрзЛрзЯрж╛рж░ ржХрзГржорж┐ред",
    "рждрж░ ржмрж╛ржкрзЗрж░ ржзржи ржжрж┐рзЯрж╛ ржбрж╛ржВржЧрзБрж▓рж┐ ржЦрзЗрж▓рзБржоред",
    "рждрж░ ржмрж╛ржкрзЗрж░ ржмрж┐ржЪрж┐ ржмрзЗржЗржЪрж╛ ржХржЯржХржЯрж┐ ржЦрж╛ржорзБред",
    "рждрж░ ржмрзМрзЯрзЗрж░ ржнрзЛржжрж╛рзЯ ржорж╛ржЧрзБрж░ ржорж╛ржЫ ржЪрж╛рж╖ ржХрж░рзБржоред",
    "рждрж░ ржзржи ржжрж┐рзЯрж╛ ржорж╛ржЯрж┐ ржЦрзБрзЬрзБржоред",
    "ржлрж╛ржЯрж╛ ржХржирзНржбржорзЗрж░ ржлрж╕рж▓ред",
    "рж▓рж╛рждрзНржерж╛рзЯ рждрж░ ржорж╛рж░ рж╢рзНржмрж╢рзБрж░ржмрж╛рзЬрзА ржлрж╛ржХрж┐рж╕рзНрждрж╛ржи ржкрж╛ржарж╛рзЯ ржжрж┐ржорзБред",
    "рж╣рж╛рждрж┐рж░ рж▓рзНржпрж╛ржУрзЬрж╛ ржжрж┐рзЯрж╛ рждрж░ ржорж╛рзЯрзЗрж░рзЗ ржЪрзБржжрзБржоред",
    "рждрж░ ржорж╛рзЯрзЗрж░ ржнрзЛржжрж╛ ржЫрж┐рж▓рзНрж▓рж╛ рж▓ржмржг рж▓рж╛ржЧрж╛рзЯ ржжрж┐ржорзБред",
    "рждрж░ ржмрж╛ржкрзЗрж░ рж╣рзЛржЧрж╛ ржжрж┐рзЯрж╛ ржЯрзНрж░рзЗржи ржнржЗрж░рж╛ ржжрж┐ржорзБред",
    "рждрж░рзЗ ржЧрзЛржЖ ржжрж┐рзЯрж╛ ржЪрзБржжрж╛ржорзБ",
    "ржПржХ ржХрж╛ржирзЗ рж╣рзЛрж▓ ржнржЗрж░рж╛ ржЖрж░рзЗржХ ржХрж╛ржи ржжрж┐рзЯрж╛ ржмрж╛ржЗрж░ ржХрж░ржорзБред",
    "рждрзЛрж░ рж╣рзЛрж▓ ржнрж╛ржЬрж┐ ржХржЗрж░рж╛ рждрзЛрж░рзЗржЗ ржЦрж╛ржУрзЯрж╛ржорзБ",
    "ржХрзБрждрзНрждрж╛рж░ ржкрзБржХржЯрж┐ ржЪрж╛ржЯрж╛ржорзБ",
    "ржорж╛рж╕рж┐ржХрзЗрж░ рждрзНржпрж╛ржирж╛ред",
    "рждрзЛрж░ ржирж╛ржХрзЗ рж╣рж╛ржЗржЧрзНржпрж╛ ржжрж┐ржорзБред",
    "рждрзЛрж░ ржмрж╛ржк ржЧрж╛ржЗрзЬрзНржпрж╛ред",
    "ржорзЛржмрж╛ржЗрж▓ ржнрж╛ржЗржмрзНрж░рзЗрж╢ржи ржХржЗрж░рж╛ рждрзБрж░ ржкрзБржХржЯрж┐рждрзЗ ржнрж░ржмрзЛред",
    "рждрзЛрж░ ржмржЗрзЯрзЗрж░ ржорзБрж╕рж▓ржорж╛ржирж┐ ржжрж┐ржорзБред",
    "рждрзЛрж░ ржмрж╛ржкрзЗ рждрзЛрж░ ржирж╛ржирж╛ред"
  ];

  let index = 0;
  activeWars[threadID] = setInterval(() => {
    if (index >= bokas.length) {
      clearInterval(activeWars[threadID]);
      delete activeWars[threadID];
      return api.sendMessage(`ЁЯШИ | ржпрзБржжрзНржз рж╢рзЗрж╖! ${targetName} ржнрж╛ржЗрж░рзЗ рж╢рж┐ржХрзНрж╖рж╛ рж╣ржЗржЫрзЗ!`, threadID);
    }

    api.sendMessage({
      body: `ЁЯШб ${targetName}, ${bokas[index]}`,
      mentions: [{
        tag: targetName,
        id: targetID
      }]
    }, threadID);

    index++;
  }, 3000); // ржкрзНрж░рждрж┐ рзй рж╕рзЗржХрзЗржирзНржбрзЗ ржПржХржЯрж╛ ржХрж░рзЗ ржорзЗрж╕рзЗржЬ ржпрж╛ржмрзЗ
};
